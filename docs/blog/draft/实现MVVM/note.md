# 实现 MVVM

不能监听什么：函数，类

1. 基本类型的监听
2. 递归和新旧值
3. 路径添加
3. 填补其他类型的监听
4. 添加一些判定
5. 实际测试


1. AST 性能优化


## 前置知识


Object.defineProperty()

[属性描述符](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty#%E5%B1%9E%E6%80%A7%E6%8F%8F%E8%BF%B0%E7%AC%A6)

**描述符必须是这两种形式之一，不能同时是两者**：
|  数据描述符  	|                             描述                            	|   默认值  	|
|:------------:	|:-----------------------------------------------------------:	|:---------:	|
|     value    	|                           属性值。                          	| undefined 	|
|   writable   	|                       可写，可被赋值。                      	|   false   	|
| configurable 	| 属性描述符能够被改变， 同时该属性也能从对应的对象上被删除。 	|   false   	|
|  enumerable  	|                           可枚举。                          	|   false   	|

|  存取描述符  	|                                      描述                                     	|   默认值  	|
|:------------:	|:-----------------------------------------------------------------------------:	|:---------:	|
|      get     	| 当访问该属性时，该方法会被执行， 方法执行时没有参数传入，但是会传入this对象。 	| undefined 	|
|      set     	|  当属性值修改时，触发执行该方法。 该方法将接受唯一参数，即该属性新的参数值。  	| undefined 	|
| configurable 	|          属性描述符能够被改变， 同时该属性也能从对应的对象上被删除。          	|   false   	|
|  enumerable  	|                                    可枚举。                                   	|   false   	|

## todo






将 callback 


我们期望是这样的：




Object.defineProperty，ES 中属性同样也是键值对，冒号左边是键的名称，右边是称作属性的值。ES5 将属性分为两种类型，一种是数据属性，一种是访问器属性可以使用 Object.defineProperty() 去定义一个数据属性或访问器属性。
MDN 代理
```js

```

遍历对象的属性，把对象的属性都使用 Object.defineProperty 转为 getter/setter ，这样，当我们修改一些值得时候，就会调用set方法，然后我们在set方法里面，回调通知，不就可以了吗，来看下面的代码：



其实是一个简单的深递归，判断每个属性内是否还是个对象，还是就递归
其核心在于给每个属性都设置上访问器属性，也就是对每个属性的值都进行了代理。

最后在 set 中将新值作为参数传递给 callback。




数组实例的proto属性，是Array.prototype的引用，当我们使用 arr1.push() 语句操作数组的时候，是调用原型下的push方法，那么我们可不可以重写原型的这些数组方法，在这些重写的方法里面去监听变化呢？答案是可以的，但是在实现之前，我们先思考一个问题，我们到底要怎么重写，比如我们重写一个数组push方法，向数组栈中推入一个元素。
要注意不要修改原生的方法，但是可以在 。



## 缺陷

实现里不支持顶级数据是Array类型，同样对Array类型数据修改会反应在整个Array上，而不是针对Array中具体项。